{"version":3,"file":"main.js","mappings":"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","sources":["webpack:///external commonjs \"tslib\"","webpack:///external commonjs \"express\"","webpack:///external commonjs \"cors\"","webpack:///./src/persist.ts","webpack:///external commonjs \"sqlite3\"","webpack:///external commonjs \"sqlite\"","webpack:///external node-commonjs \"path\"","webpack:///webpack/bootstrap","webpack:///./src/main.ts"],"sourcesContent":["module.exports = require(\"tslib\");","module.exports = require(\"express\");","module.exports = require(\"cors\");","import sqlite3 from 'sqlite3';\nimport { open } from 'sqlite';\n\nlet _db;\n\nasync function getDB() {\n  if (_db == null) {\n    const conn = await open({\n      filename: './urls.db',\n      driver: sqlite3.Database,\n    });\n    _db = conn;\n    await _db.run('CREATE TABLE IF NOT EXISTS url (id INTEGER PRIMARY KEY AUTOINCREMENT, original TEXT);');\n  }\n  return _db;\n}\n\nexport async function shortenUrl(url: string): Promise<string> {\n  const db = await getDB();\n\n  const result = await db.run('INSERT INTO url (original) VALUES (?)', url);\n  const id = result.lastID;\n  const short = `http://localhost:3333/s/${id}`;\n\n  return short;\n}\n\nexport async function lookupUrl(shortenedId: number) {\n  const db = await getDB();\n\n  const result = await db.get('SELECT original FROM url WHERE id = (?)', shortenedId);\n  return result.original;\n}\n","module.exports = require(\"sqlite3\");","module.exports = require(\"sqlite\");","module.exports = require(\"path\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import express from 'express';\nimport cors from 'cors';\nimport { shortenUrl, lookupUrl } from './persist';\nimport * as path from 'path';\n\ntype MainDependencies = {\n  shortenUrl: (original: string) => Promise<string>;\n  lookupUrl: (shortId: number) => Promise<string>;\n};\n\n// Composition Root\nconst deps: MainDependencies = {\n  shortenUrl,\n  lookupUrl,\n};\n\nasync function main({ shortenUrl, lookupUrl }: MainDependencies) {\n  const app = express();\n  app.use(express.json());\n  app.use(cors());\n\n  app.use(express.static(path.join(__dirname, '../../../../dist/apps/url/client')));\n\n  app.post('/api/shorten', async (req, res) => {\n    const original = req.body.original;\n    const short = await shortenUrl(original);\n\n    res.send({\n      short: short,\n      original: original,\n    });\n  });\n\n  app.get('/s/:id', async (req, res) => {\n    const id = Number(req.params.id);\n    const original = await lookupUrl(id);\n    res.redirect(original);\n  });\n\n  app.get('*', (req, res) => {\n    res.sendFile(path.resolve(__dirname, 'dist/apps/url/client/index.html'));\n  });\n\n  const port = process.env.PORT || 3333;\n  const server = app.listen(port, () => {\n    console.log(`Listening at http://localhost:${port}/api`);\n  });\n  server.on('error', console.error);\n}\n\nmain(deps);\n"],"names":[],"sourceRoot":""}